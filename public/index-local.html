<!DOCTYPE html>
<html lang="en">
  <head>
    <!--[if IE]>
      <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <![endif]-->
    <meta charset="utf-8" />
    <title>doge Gallery</title>
    <meta
      name="description"
      content="blueimp Gallery is a touch-enabled, responsive and customizable image and video gallery, carousel and lightbox, optimized for both mobile and desktop web browsers. It features swipe, mouse and keyboard navigation, transition effects, slideshow functionality, fullscreen support and on-demand content loading and can be extended to display additional content types."
    />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link rel="stylesheet" href="css/blueimp-gallery.css" />
    <link rel="stylesheet" href="css/blueimp-gallery-indicator.css" />
    <link rel="stylesheet" href="css/demo/demo.css" />
  </head>
  <body style="background: #fff">
    <h2 style="color:#414141;">doge image gallery</h2>
    <!-- The container for the list of example images -->
    <div id="links" class="links"></div>
    <!-- The Gallery as lightbox dialog -->
    <div id="blueimp-gallery" class="blueimp-gallery">
      <div class="slides"></div>
      <h3 class="title"></h3>
      <a class="prev">‹</a>
      <a class="next">›</a>
      <a class="close">×</a>
      <a class="play-pause"></a>
      <ol class="indicator"></ol>
    </div>
    <div id="testArea" style="position: fixed;bottom: 5px;left: 5px;">
      <img src="" alt="" id="img">
      <button id="sharp">sharp</button>
      <button id="base64Get">get img as base64</button>
    </div>
    <script src="js/vendor/jquery.min.js"></script>
    <script src="js/vendor/lodash.min.js"></script>
    <script src="js/vendor/axios.min.js"></script>
    <script src="js/blueimp-helper.js"></script>
    <script src="js/blueimp-gallery.js"></script>
    <script src="js/blueimp-gallery-fullscreen.js"></script>
    <script src="js/blueimp-gallery-indicator.js"></script>
    <script src="js/jquery.blueimp-gallery.js"></script>
    <script>
      $(async () => {
        const imgList = await axios.get('http://localhost:9072/images?_sort=createdAt&_order=desc')
        const ids = _.map(imgList.data, (i) => {
          return i.id
        })
        let filter = ''
        _.forEach(ids, (i) => {
          filter += `id=${i}&`
        })
        const { data } = await axios.post('http://localhost:9071/thumbs', { filter })
        const linksContainer = $('#links')
        _.forEach(data, (i) => {
          $('<a/>')
              .append($('<img>').prop('src', i.base64))
              .prop('href', `http://localhost:9071/image/${i.fileName}`)
              .prop('title', i.id)
              .attr('data-gallery', '')
              .appendTo(linksContainer)
        })
        $('#sharp').click(async () => {
          const { data } = await axios.get('http://localhost:9071/resize/5bPYrxWCZ?w=100&h=200&format=jpg')
          $('#img').attr('src', data)
        })
        $('#base64Get').click(async () => {
          const { data } = await axios.get('http://localhost:9071/image/5bPYrxWCZ.png?base64=1')
          $('#img').attr('src', data)
        })
      })
    </script>
  </body>
</html>
